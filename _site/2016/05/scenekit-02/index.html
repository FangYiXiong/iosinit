<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <title>「从零开始」做一个水果忍者那样的游戏（Scene Kit 基础教程）第 2 节：节点</title>
  <meta name="description" content="原文：Scene Kit Tutorial with Swift Part 2: Nodes">
  <meta name="author" content="Wei Wang">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="「从零开始」做一个水果忍者那样的游戏（Scene Kit 基础教程）第 2 节：节点">
  <meta name="twitter:description" content="原文：Scene Kit Tutorial with Swift Part 2: Nodes">
  
  <meta property="og:type" content="article">
  <meta property="og:title" content="「从零开始」做一个水果忍者那样的游戏（Scene Kit 基础教程）第 2 节：节点">
  <meta property="og:description" content="原文：Scene Kit Tutorial with Swift Part 2: Nodes">
  
  <link rel="icon" type="image/png" href="/assets/images/favicon.png" />
  <link href="/assets/images/favicon.png" rel="shortcut icon" type="image/png">
  
  <link rel="stylesheet" href="/css/main.css">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="canonical" href="http://vno.onevcat.com/2016/05/scenekit-02/">
  <link rel="alternate" type="application/rss+xml" title="iOS init" href="http://vno.onevcat.com/feed.xml">
  
  <meta name="google-site-verification" content="1-1ZlHoRvM0T2FqPbW2S-qLgYXN6rsn52kErlMPd_gw" />
  
</head>


  <body>

    <span class="mobile btn-mobile-menu">
        <i class="fa fa-list btn-mobile-menu__icon"></i>
        <i class="fa fa-angle-up btn-mobile-close__icon hidden"></i>
    </span>
    
    <header class="panel-cover panel-cover--collapsed" style="background-image: url('/assets/images/background-cover.jpg')">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        <a href="/#blog" title="前往 iOS init 的主页" class="blog-button"><img src="/assets/images/avatar.jpg" width="80" alt="iOS init logo" class="panel-cover__logo logo" /></a>
        <h1 class="panel-cover__title panel-title"><a href="/#blog" title="link to homepage for iOS init" class="blog-button">iOS init</a></h1>
        
        <span class="panel-cover__subtitle panel-subtitle">程序让这个世界更美好</span>
        
        <hr class="panel-cover__divider" />
        <p class="panel-cover__description">嗨，我是方一雄，这是我的 iOS 视频教程小站，欢迎您的光临。</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />
        
        
        <p class="panel-cover__description"><a href="http://www.zaih.com/mentor/84894970/topic/29873289/" target="_blank">One to One</a></p>
        
        
        <div class="navigation-wrapper">
          <div>
            <nav class="cover-navigation cover-navigation--primary">
              <ul class="navigation">
                <li class="navigation__item"><a href="/#blog" title="Visit blog" class="blog-button">文章</a></li>
                
                  <li class="navigation__item"><a href="http://" target="_blank" title="Videos">视频</a></li>
                
                  <li class="navigation__item"><a href="http://project.iosinit.com" target="_blank" title="My Project">项目</a></li>
                
                  <li class="navigation__item"><a href="http://about.iosinit.com" target="_blank" title="A button">关于</a></li>
                
              </ul>
            </nav>
          </div>
          
          <div><nav class="cover-navigation navigation--social">
  <ul class="navigation">

  
  <!-- Weibo -->
  <li class="navigation__item">
    <a href="http://weibo.com/fangyixiong" title="@fangyixiong 的微博" target="_blank">
      <i class='social fa fa-weibo'></i>
      <span class="label">Weibo</span>
    </a>
  </li>
  

  
  <!-- Github -->
  <li class="navigation__item">
    <a href="https://github.com/fangyixiong" title="@fangyixiong 的 Github" target="_blank">
      <i class='social fa fa-github'></i>
      <span class="label">Github</span>
    </a>
  </li>
  
  
  
  <!-- Twitter -->
  <li class="navigation__item">
    <a href="http://twitter.com/fangyixiong" title="@fangyixiong" target="_blank">
      <i class='social fa fa-twitter'></i>
      <span class="label">Twitter</span>
    </a>
  </li>
  

  

  <!-- RSS -->
  <li class="navigation__item">
    <a href="/feed.xml" rel="author" title="RSS" target="_blank">
      <i class='social fa fa-rss'></i>
      <span class="label">RSS</span>
    </a>
  </li>

  
  <!-- Email -->
  <li class="navigation__item">
    <a href="mailto:hide.fyx@gmail.com" title="Contact me">
      <i class='social fa fa-envelope'></i>
      <span class="label">Email</span>
    </a>
  </li>
  

  </ul>
</nav>
</div>
        </div>
      </div>
    </div>
    
    
    <div class="panel-cover--overlay cover-blue"></div>
    
  </div>
</header>


    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            <article class="post-container post-container--single" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <div class="post-meta">
      <time datetime="2016-05-03 07:08:18 +0800" itemprop="datePublished" class="post-meta__date date">2016-05-03</time> &#8226; <span class="post-meta__tags tags">3d-game</span>
    </div>
    <h1 class="post-title">「从零开始」做一个水果忍者那样的游戏（Scene Kit 基础教程）第 2 节：节点</h1>
  </header>

  <section class="post">
    <p>原文：<a href="https://www.raywenderlich.com/128681/scene-kit-tutorial-swift-part-2-nodes">Scene Kit Tutorial with Swift Part 2: Nodes</a></p>

<blockquote>
<p>注：这是<a href="https://www.raywenderlich.com/store/3d-ios-games-by-tutorials">《3D iOS 游戏教程》</a>这本书中一个章节的缩写版，来让您可以来领略一下这本书的内容。希望您喜欢！</p>
</blockquote>

<p><img src="http://7xqycx.com1.z0.glb.clouddn.com/2016-04-29-Thumb.gif" alt=""></p>

<p>这一教程将向你展示如何使用苹果最新的游戏框架－SceneKit，来创建你的第一个 3D 游戏。</p>

<p>在这个一共 5 节的系列教程中，你将会创建你的第一个 SceneKit 游戏：<strong>几何忍者（GeometryFighter）</strong>！这是一个类似于<strong><a href="https://itunes.apple.com/cn/app/fruit-ninja/id362949845?mt=8">水果忍者</a></strong>那样的游戏，你来摧毁不断涌上屏幕的几何体来满足自己内心的破坏欲:]</p>

<p>下面是本系列教程文章的导航及简介：</p>

<ul>
<li><p><a href="http://iOSinit.com/scenekit-01">第 1 节</a>，你将会学习到如何新建一个空白的 SceneKit 工程做为一个好的开始。</p></li>
<li><p><a href="http://iOSinit.com/scenekit-02">第 2 节</a>，开始编写游戏，并学习有关 SceneKit 节点的知识。</p></li>
<li><p><a href="http://iOSinit.com/scenekit-03">第 3 节</a>，学习如何使用 SceneKit 内置的物理引擎来移动你的几何体。</p></li>
<li><p><a href="http://iOSinit.com/scenekit-04">第 4 节</a>，学习有关 SceneKit 中有关渲染循环的知识，并让你的几何体不断重生。</p></li>
<li><p>在最后的<a href="http://iOSinit.com/scenekit-05">第 5 节</a>中，你将学习如何将一些非常酷的粒子效果添加到游戏中。</p></li>
</ul>

<p>在<a href="http://iOSinit.com/scenekit-01">上一节</a>的学习中，我们了解了如何新建一个空白的 SceneKit 工程做为一个好的开始。</p>

<p>在本节的教程里，我们将开始编写游戏，在这个过程中学习有关<strong>节点（Node）</strong>的知识。</p>

<blockquote>
<p>本篇教程从上一节教程结束的地方开始。如果你没有跟上，不要着急 ———— 你可以从这里下载本次教程的<a href="https://github.com/FangYiXiong/GeometryFighter/archive/part-1-finished.zip">开始程序包</a>。</p>
</blockquote>

<h2>开始</h2>

<p>Scene Kit 中把所有游戏中的元素以一种<strong>场景图（scene graph）</strong>的方式组织起来。</p>

<p>每一个游戏中的元素（比如灯光、摄像头、粒子发射器等）都被称为一个个的<strong>节点（node）</strong>存储在这种树形结构中。</p>

<p>为了说明它的工作原理，我们来看看下面这张图：</p>

<p><img src="http://7xqycx.com1.z0.glb.clouddn.com/2016-05-03-14621827798929.jpg" alt=""></p>

<p>为了进行类比，我们把上面这个图中每一个骨头都想象成一个<strong>节点（node）</strong>。最大的骨头是脊柱，我们认为它是所有骨头的根源，所以它就是<strong>根节点（root node）</strong>。肩骨是连接在脊柱上的，所以我们认为肩骨是脊柱的<strong>子（child）</strong>节点，而脊柱则是肩骨的<strong>父（parent）</strong>节点。</p>

<p>同理可知，大臂的骨头是肩骨的子节点，小臂的骨头是大臂骨头的子节点，手指的骨头是小臂的骨头的子节点。</p>

<p>每一个节点的位置都是相对于它的父节点的。比如，如图中右边所示，要想挥动骷髅的左边的手臂，我们只需要像蓝色箭头这样旋转他的大臂的骨头，所有的子节点（小臂、手指）都会跟着一起旋转了。</p>

<p>恭喜你！你刚刚学习完了人体解剖学的入门课程！:]</p>

<h3>代码中的节点</h3>

<p>从技术的角度来看，一个节点的类型是 <strong>SCNNode</strong>，它代表了在三维空间中相对于父节点的位置。节点本身并不包含任何可以显示的内容，在渲染到场景上之后也会消失不见。为了创建可以显示的内容，你需要将其他的组件，比如灯光、摄像机或者几何体（比如骨头）添加到节点上。</p>

<p>场景图中有一个特殊的节点形成了整个节点层级结构的基础，它就是<strong>根节点（root node）</strong>。为了构建游戏场景，我们把节点做为子节点要么加入到根节点中，要么就加入到根节点的其它子节点中。</p>

<h2>Scene Kit 中的资源目录（Asset Catalog）</h2>

<p>如果有一天你变成了成功又有钱的 3D 游戏设计者，你可以自己雇佣图形设计师以及音效工程师，这样你就可以把时间全部用来专心致志地写游戏代码了。:] Scene Kit 中的<strong>资源目录（Asset Catalog）</strong>就是设计来专门帮你处理这些代码之外的游戏资源的。</p>

<p>资源目录（Asset Catalog）让我们可以一个单独的文件夹里管理所有的游戏资源；使用它只需要我们在工程中新建一个以 <strong>.scnassets</strong> 为扩展名的文件夹，然后把所有的游戏资源文件放在那个文件夹里就可以了。Xcode 在编译的时候会自动把所有这个目录下的文件拷贝程序包里，并且保留你文件夹里的层级结构。</p>

<p>这样做的好处在于，你只需要把资源目录文件夹共享给设计师，如果有什么需要修改的问题（比如某只 不-是-那-么-凶-的-重-眼-怪），他们直接在上面修改之后，效果就会出现在你下一次编译的时候了，不需要来回拷来拷去的。</p>

<p>现在你应该明白资源目录的作用是什么了，很快你就要在几何忍者中添加一个这样的目录。</p>

<p>把教程<a href="https://github.com/FangYiXiong/GeometryFighterResources/archive/1.0.zip">资源文件包</a>中的 <strong>GeometryFighter.scnassets</strong> 文件夹拖拽到 Xcode 的游戏工程里。在弹出的窗口中，确保 <strong>Copy items if needed</strong>、<strong>Create Groups</strong>，以及 Add to targets 中的 <strong>GeometryFighter</strong> 是选中状态，然后点击 <strong>Finish</strong>。</p>

<p><img src="http://7xqycx.com1.z0.glb.clouddn.com/2016-04-29-14619198673738.png" alt=""></p>

<p>在项目的导航中选择 <strong>GeometryFighter.scnassets</strong> 这个文件夹，你会注意到在右边的面板中出现了一些独有的选项。展开GeometryFighter.scnassets 及它的子文件夹来查看更多细节：</p>

<p><img src="http://7xqycx.com1.z0.glb.clouddn.com/2016-04-29-14619201167460.png" alt=""></p>

<p>你会看到在资源目录下有两个文件夹：<strong>Sounds</strong>（声音）文件夹包含了游戏所需的声音文件，<strong>Textures</strong>（纹理）文件夹包含了所需的图像。你可以尽情地看看都是些什么内容。</p>

<h3>添加启动屏幕</h3>

<p>我们刚刚添加好了资源目录，现在需要做一些整理工作，并添加一张合适的图片做为启动屏幕。</p>

<p>首先，在项目的导航栏中单击 <strong>Assets.xcassets</strong>，把<strong>GeometryFighter.scnassets\Textures\Logo_Diffuse.png</strong> 这个文件拖进资源里，就放在 <strong>AppIcon</strong> 的下面。</p>

<p><img src="http://7xqycx.com1.z0.glb.clouddn.com/2016-04-29-14619205512274.png" alt=""></p>

<p>下一步，点击导航栏中的 <strong>LaunchScreen.storyboard</strong>。选中 <strong>View</strong>，在右边的属性设置栏中，把 <strong>Background</strong>（背景）这个属性设置为深蓝色（或者任何你喜欢的颜色），如下图：</p>

<p><img src="http://7xqycx.com1.z0.glb.clouddn.com/2016-04-29-14619206722893.png" alt=""></p>

<p>下一步，将 <strong>Logo_Diffuse</strong> 这张图片从 <strong>Media Library</strong>（媒体库）拖到视图的正中。把这张图片的 <strong>Mode</strong>（拉伸模式）属性设置为 <strong>Aspect Fit</strong>（等比例缩放），如下图：</p>

<p><img src="http://7xqycx.com1.z0.glb.clouddn.com/2016-04-29-14619209162851.png" alt=""></p>

<p>干的漂亮，就还差一点点就完成了。现在我们需要添加一些约束来保证图片在所有 iOS 设备上的正常显示。在底部点击 <strong>Pin</strong> 这个按钮，把四个边的约束都点亮，然后点击底部的 <strong>Add 4 Constraints</strong>的按钮，如图所示：</p>

<p><img src="http://7xqycx.com1.z0.glb.clouddn.com/2016-04-29-14619210793978.png" alt=""></p>

<p>这样我们就添加好了启动屏幕！编译并运行程序；你会看到一个崭新的启动屏幕：</p>

<p><img src="http://7xqycx.com1.z0.glb.clouddn.com/2016-04-29-14619211674625.png" alt=""></p>

<h3>添加背景图片</h3>

<p>炫酷的启动画面一消失，你就又被扔回到了命运的黑色大门前。现在是时候添加一个漂亮的背景了，这样你就不会感觉自己在盯着一个黑洞了。</p>

<p>为了完成这个，打开 <strong>GameViewController.swift</strong> 这个文件，将下面这行代码添加到<code>配置场景()</code>这个方法的底部：</p>
<figure class="highlight"><pre><code class="language-text" data-lang="text">scn场景.background.contents = &quot;GeometryFighter.scnassets/Textures/Background_Diffuse.png&quot;
</code></pre></figure>
<p>这行代码告诉我们的场景去加载资源目录中一个名为 <strong>Background_Diffuse.png</strong> 的图片，使用它来做我们的背景。</p>

<p>编译并运行；游戏运行后你将看到一个蓝色的背景图：</p>

<p><img src="http://7xqycx.com1.z0.glb.clouddn.com/2016-04-29-14619218206030.png" alt=""></p>

<p>你现在已经完成了基本的清理工作。你的游戏现在有了一个闪亮的图标、一个耀眼的启动图，外加一个非常漂亮的背景！接下来我们要准备向上面添加并显示<strong>节点（Node）</strong>了。</p>

<h2>Scene Kit 的坐标系</h2>

<p>在开始添加节点之前，你首先需要理解 Scene Kit 的坐标系的有关知识，这样你才能把节点放到想要的位置上。</p>

<p>在诸如 UIKit 和 Sprite Kit 这样的 2D 系统中，你使用一个包含 X 坐标和 Y 坐标的点来描述一个视图（view）或者一个精灵（sprite）的位置。而在三维的空间里，为了确定一个物体的位置，你还需要一个 Z 轴的坐标来描述物体的深度。</p>

<p>来看下面这个示意图：</p>

<p><img src="http://7xqycx.com1.z0.glb.clouddn.com/2016-05-03-14619846843863.png" alt=""></p>

<p>Scene Kit 使用这种三个轴的坐标系来描述一个物体在三维空间中的位置。红色的方块放置在 X 轴上，绿色的方块放置在了 Y 轴，蓝色的方块放置在了 Z 轴。正中间的灰色的方块代表了<strong>原点（origin）</strong>，坐标为<strong>（x:0, y:0, z:0）</strong>。</p>

<p>Scene Kit 使用 <strong>SCNVetor3</strong> 这种包含三个向量的数据类型来代表三维空间中的坐标。在代码中我们这样写：</p>
<figure class="highlight"><pre><code class="language-text" data-lang="text">let 位置 = SCNVector3(x:0, y:5, z:10)
</code></pre></figure>
<p>这里，我们使用向量 <strong>(x:0, y:5, z:10)</strong> 来声明了一个变量<code>位置</code>。可以使用下面这种方法来轻松地得到每个坐标的数值：</p>
<figure class="highlight"><pre><code class="language-text" data-lang="text">let x = 位置.x
let y = 位置.y
let z = 位置.z
</code></pre></figure>
<p>如果你以前使用过<code>CGPoint</code>，那么你应该可以很容易地看出 <code>SCNVetor3</code> 和它的类似之处。</p>

<blockquote>
<p>注：节点（Node）加入到场景的时候有一个默认的位置是 <strong>(x:0, y:0, z:0)</strong>，记住这里的位置都是指相对于<strong>父节点</strong>而言的。为了把一个节点放置在指定的位置上，我们需要调整其相对于它的父节点（亦称为本地坐标）的位置，而不是相对于原点（世界坐标）的位置。</p>
</blockquote>

<h2>摄像机的工作原理</h2>

<p>理解了如何在 Scene Kit 中放置节点之后，你可能很好奇如何真正把内容<strong>显示</strong>在屏幕上。想一下第 1 章中关于拍电影的类比：拍电影的时候，场景上有各种演员和道具，然后我们会放置一个摄像机来拍摄场景，所以最终出来的影像什么样取决于摄像机的位置，我们看到的也是摄像机的视角。</p>

<p>Scene Kit 的工作原理也是类似的。包含<strong>摄像机（camera）</strong>的那个节点的位置决定了我们看场景的视角。</p>

<p>下面这个示意图说明了摄像机是如何工作的：</p>

<p><img src="http://7xqycx.com1.z0.glb.clouddn.com/2016-05-03-14619868670628.jpg" alt=""></p>

<p>图中有几个关键术语需要解释一下：</p>

<ul>
<li>摄像机拍摄的方向永远是其所在节点位置的<strong>负的 Z 轴</strong>方向。</li>
<li><strong>视野（Field of View）</strong>是摄像机的可视区域的极限角度。角度越小，视野越窄，反之，角度越大，视野越宽。</li>
<li><strong>视锥体（viewing frustum）</strong>决定着摄像头可视区域的深度（Z 轴表示深度）。任何不在这个区域内的物体将被剪裁掉（离摄像头太近或者太远），不会显示在最终的画面中。</li>
</ul>

<p>Scene Kit 中 <code>SCNCamera</code> 这个类就代表了摄像头，它有几个属性，其中 <code>xPov</code> 和 <code>yPov</code> 用来调整视野，<code>zNear</code> 和 <code>zFar</code> 用来调整视锥体。</p>

<p>另外，有一点很关键要记住，那就是摄像头只有附属于某个节点时才发挥作用，只有其本身不会做任何事情。</p>

<h2>添加摄像头</h2>

<p>现在我们来试试摄像头。打开 <strong>GameViewController.swift</strong> 这个文件，在 <code>scn场景</code> 的下面再添加一个属性：</p>
<figure class="highlight"><pre><code class="language-text" data-lang="text">var 摄像头节点: SCNNode!
</code></pre></figure>
<p>接下来，在<code>配置场景()</code>方法的下面再添加一个新方法：</p>
<figure class="highlight"><pre><code class="language-text" data-lang="text">func 配置摄像头() {
  // 1
  摄像头节点 = SCNNode()
  // 2
  摄像头节点.camera = SCNCamera()
  // 3
  摄像头节点.position = SCNVector3(x: 0, y: 0, z: 10)
  // 4
  scn场景.rootNode.addChildNode(摄像头节点)
}
</code></pre></figure>
<p>我们来看一下这些代码：</p>

<ol>
<li>首先创建一个空的节点 <code>SCNNode</code> 并把它赋值给了变量 <code>摄像头节点</code>。</li>
<li>然后创建一个新的 <code>SCNCamera</code> 对象并把它赋值给了 <code>摄像头节点</code> 的 <code>camera</code> 这个属性。</li>
<li>然后设置 <code>摄像头节点</code> 的位置为 <strong>(x:0, y:0, z:10)</strong>。</li>
<li>最后，把<code>摄像头节点</code>作为子节点加入到场景的根节点中。</li>
</ol>

<p>然后我们在 <code>viewDidLoad()</code> 这个方法中调用刚刚添加的这个新方法，在 <code>配置场景</code> 这行的下面再添加一行代码：</p>
<figure class="highlight"><pre><code class="language-text" data-lang="text">配置摄像头()
</code></pre></figure>
<p>完成这一步之后并不需要立即运行，因为这时候你看不到什么变化。现在我们的场景中的确添加了摄像头，但是并没有什么东西可供我们拍摄。接下来，为了解决这个问题，让我们添加一些演员到场景来。</p>

<h2>了解几何体</h2>

<p>为了创建可见的内容，我们需要把几何体添加到节点中。一个几何体代表了一个三维立体的形状，由无数个<strong>交点（Vertices）</strong>构成。</p>

<p>另外，一个几何体可以使用不同的材料来装饰它的表面。<strong>材料（Material）</strong>可以让我们指定物体表面的颜色、材质、对光的敏感度等一系列的视觉效果。一系列交点和材料的组合被称为一个<strong>模型（Model）</strong>或是一个<strong>网（Mesh）</strong>。</p>

<p>Scene Kit 内置了一系列的几何体，也被称为<strong>原型（Primitives）</strong>：</p>

<p><img src="http://7xqycx.com1.z0.glb.clouddn.com/2016-05-03-14621755013065.png" alt=""></p>

<p>前排从左到右是：圆锥体（cone）、圆环体（torus）、胶囊体（capsule）、水管体（tube）。后排从左到右分别是：锥体（pyramid）、立方体（box）、球体（sphere）和圆柱体（cylinder）。</p>

<blockquote>
<p>你可以提供自定义的几何体，在之后的章节中将会教你如何去做。</p>
</blockquote>

<h3>添加形状</h3>

<p>在把几何体添加进场景之前，我们需要创建一个新的 Swift 文件来声明一个名为<code>形状</code>的枚举用来定义游戏中用到的各种不同的几何体形状。</p>

<p>右键单击 <strong>GeometryFighter</strong> 这个组，然后选择 <strong>New File</strong>……选择 <strong>iOS\Source\Swift File</strong> 这个模版，然后单击 <strong>Next</strong>：</p>

<p><img src="http://7xqycx.com1.z0.glb.clouddn.com/2016-05-03-14621769376582.png" alt=""></p>

<p>把这个文件命名为<strong>形状.swift</strong>，确保其包含在工程文件里，然后单击 <strong>Create</strong>。</p>

<p>文件创建好了之后，打开<strong>形状.swift</strong>，把文件里的内容替换为下列代码：</p>
<figure class="highlight"><pre><code class="language-text" data-lang="text">import Foundation
 
// 1
public enum 形状:Int {
 
  case 立方体 = 0
  case 球体
  case 锥体
  case 圆环体
  case 胶囊体
  case 圆柱体
  case 圆锥体
  case 水管体
 
  // 2
  static func 随机() -&gt; 形状 {
    let 最大值 = 水管体.rawValue
    let 随机 = arc4random_uniform(UInt32(最大值+1))
    return 形状(rawValue: Int(随机))!
  }
}
</code></pre></figure>
<p>上述代码的意思相当直白：</p>

<ol>
<li>定义一个公有的枚举<code>形状</code>代表不同的几何体类型。</li>
<li>定义了一个静态的方法<code>随机()</code>用来生成随机的形状。这个方法之后会很有用。</li>
</ol>

<h3>添加几何体</h3>

<p>下面的任务就是创建一个方法来随机生成<strong>形状</strong>这个枚举中所定义的几何体类型。</p>

<p>在下面的方法添加到 <strong>GameViewController.swift</strong> 中，就放到 <code>配置摄像头()</code> 的下面：</p>
<figure class="highlight"><pre><code class="language-text" data-lang="text">func 生成几何体() {
    // 1
    var 几何体: SCNGeometry
    // 2
    switch 形状.随机() {
    default:
        // 3
        几何体 = SCNBox(width: 1.0, height: 1.0, length: 1.0, chamferRadius: 0.0)
    }
    // 4
    let 几何体节点 = SCNNode(geometry: 几何体)
    // 5
    scn场景.rootNode.addChildNode(几何体节点)
}
</code></pre></figure>
<p>下面按照注释的顺序一个个地来解释：</p>

<ol>
<li>首先，声明一个变量<code>几何体</code>备用。</li>
<li>接下来，使用一个 <strong>switch</strong> 语句来处理 <code>形状.随机()</code> 这个方法的返回值。现在这里的代码还不完整，只会生成一个正方体。在文章结尾的挑战中，需要你把它来补充完整。</li>
<li>然后创建一个 <code>SCNBox</code> 立方体的对象并把它存储在<code>几何体</code>中。这里要指定它的宽、高、长，以及斜面角度（也就是所谓的圆角，只不过换了个更高大上的说法）。</li>
<li>这一行我们创建了一个<code>SCNNode</code>的节点的对象并把它命名为<code>几何体节点</code>，这次我们使用的是带 <code>geometry</code> 参数的初始化方法，这样生成的节点会自动跟我们提供的几何体链接起来。</li>
<li>最后，我们把创建好的几何体节点添加到场景中。</li>
</ol>

<p>现在，我们需要在程序的某处来调用这个方法。在 <code>viewDidLoad()</code> 中，紧挨着<code>配置摄像头()</code>这一行的下面，添加下面的代码：</p>
<figure class="highlight"><pre><code class="language-text" data-lang="text">生成几何体()
</code></pre></figure>
<p>编译并运行；你会发现屏幕中显示了一个白色的方块。如下图所示：</p>

<p><img src="http://7xqycx.com1.z0.glb.clouddn.com/2016-05-03-14621793013917.png" alt=""></p>

<p>这里我们可以看到几点：</p>

<ol>
<li>这个立方体节点是<code>生成几何体</code>生成的默认的形状，在场景中位于 <strong>(x:0, y:0, z:0)</strong> 的位置。</li>
<li>你正在从之前创建的<code>摄像头节点</code>所在的位置观察这个场景。由于摄像头节点的位置在 <strong>(x:0, y:0, z:10)</strong>，所以这个立方体刚好就处在我们摄像头视野的正中间。</li>
</ol>

<p>没错，我知道这看起来一点也不令人兴奋（而且看上去也不像是 3D 的），但是别着急——下一节会改变一切。</p>

<h2>使用内置的 3D 图形浏览器</h2>

<p><code>SCNView</code> 内置了一些可以直接拿来使用的功能来让我们的工作轻松一些。</p>

<p>来到 <strong>GameViewController.swift</strong> 这个文件，在<code>配置视图()</code>这个方法的最后，增加以下的代码：</p>
<figure class="highlight"><pre><code class="language-text" data-lang="text">// 1
scn视图.showStatistics = true
// 2
scn视图.allowsCameraControl = true
// 3
scn视图.autoenablesDefaultLighting = true
</code></pre></figure>
<p>下面来解释一下上面的代码在干嘛：</p>

<ol>
<li><strong>showStatistics</strong> 会在底部打开一个实时的统计数据的面板。</li>
<li><strong>allowsCameraControl</strong> 允许用户使用简单的手势来控制摄像机。</li>
<li><strong>autoenablesDefaultLighting</strong> 会自动给我们的场景添加一个全方向的灯光，这样暂时我们就不需要自己来添加灯光了。</li>
</ol>

<p>编译并运行；这次事情开始变得有趣起来了！</p>

<p><img src="http://7xqycx.com1.z0.glb.clouddn.com/2016-05-03-14621814916855.png" alt=""></p>

<p>你可以使用以下的手势来控制场景中活动的摄像机：</p>

<ul>
<li><strong>单手指滑动</strong>：围绕着物体旋转你的摄像机。</li>
<li><strong>两只手指滑动</strong>：上下左右移动你的摄像机。</li>
<li><strong>两只手指缩放</strong>：拉近或拉远你的摄像机。</li>
<li><strong>双击</strong>：如果你的场景中有两个或以上的摄像机，这个动作会在不同的摄像机之间进行切换。当然，在本例中，我们只有一个摄像机，所以不会进行切换。但这个手势在切换的同时也会把摄像机的状态重设回最初的状态。</li>
</ul>

<h2>挑战</h2>

<p>在本节的最后，我们留了一个挑战任务来供你实践学习到的知识：完善 <code>生成几何体()</code> 中的 <strong>switch</strong> 语句，来处理其它的几何体类型。</p>

<p>在苹果官方的 <a href="https://developer.apple.com/library/ios/documentation/SceneKit/Reference/SCNGeometry_Class/index.html#//apple_ref/occ/cl/SCNGeometry">Scene Kit 文档</a>中查看更多关于不同几何体的说明。同时看看<code>形状</code>这个枚举中的各种类型的名字，应该可以给你足够的提示来开始。</p>

<p>不用太担心尺寸的问题；试试让它们看起来跟之前的正方体差不多大小就可以。</p>

<p>如果你完成了挑战，那么恭喜你！你已经牢牢掌握了 Scene Kit 中最基本的一些概念了！</p>

<h2>接下来怎么办？</h2>

<p>这里是<a href="https://github.com/FangYiXiong/GeometryFighter/archive/part-2-finished.zip">完成 Demo 后的代码</a>。</p>

<p>这里是<a href="https://github.com/FangYiXiong/GeometryFighter/archive/part-2-challenge-finished.zip">完成挑战后的代码</a>。</p>

<p>就目前而言，您应该继续阅读本系列教程的<a href="http://iOSinit.com/scenekit-03">第三节</a>，在第三节中，我们将学习如何使用物理引擎让几何体动起来。</p>

<p>本节视频教程：<a href="http://">地址</a></p>

<p>免费直播教程：<a href="http://www.swiftv.cn/course/inen5bqr">直播地址</a></p>

<blockquote>
<p>译者注：如果您刚开始学习 iOS 开发，希望系统地学习并得到及时的指导，可以考虑来购买我的视频教程：<a href="http://iosinit.com/ios-3d-games/">「从零开始」学习 3D iOS游戏编程</a></p>

<p>这一教程基于本文提及的<a href="https://www.raywenderlich.com/store/3d-ios-games-by-tutorials">《3D iOS 游戏教程》</a>这本书，将会教给你制作 3D iOS 游戏中所需要知道的一切知识，在这个过程中你将从头开始制作一系列类似于<a href="(https://itunes.apple.com/cn/app/fruit-ninja/id362949845?mt=8)">水果忍者</a>、经典的敲砖块，甚至苹果 WWDC 上和 Apple TV 一起首发的游戏 —— <a href="https://itunes.apple.com/us/app/crossy-road-endless-arcade/id924373886?mt=8">Crossy Road</a>。</p>

<p>于此同时，如果您有任何问题，欢迎在微博上 <a href="http://weibo.com/fangyixiong">@方一雄</a> 给我留言或私信。</p>
</blockquote>

  </section>
</article>

<section class="read-more">
   
   
   <div class="read-more-item">
       <span class="read-more-item-dim">最近的文章</span>
       <h2 class="post-list__post-title post-title"><a href="/2016/05/scenekit-03/" title="link to 「从零开始」做一个水果忍者那样的游戏（Scene Kit 基础教程）第 3 节：物理引擎">「从零开始」做一个水果忍者那样的游戏（Scene Kit 基础教程）第 3 节：物理引擎</a></h2>
       <p class="excerpt">原文：Scene Kit Tutorial with Swift Part 3: Physics注：这是《3D iOS 游戏教程》这本书中一个章节的缩写版，来让您可以来领略一下这本书的内容。希望您喜欢！这一教程将向你展示如何使用苹果最新的游戏框架－SceneKit，来创建你的第一个 3D 游戏。在这个一共 5 节的系列教程中，你将会创建你的第一个 SceneKit 游戏：几何忍者（GeometryFighter）！这是一个类似于水果忍者那样的游戏，你来摧毁不断涌上屏幕的几何体来满足自己内心...&hellip;</p>
       <div class="post-list__meta"><time datetime="2016-05-20 14:09:37 +0800" class="post-list__meta--date date">2016-05-20</time> &#8226; <span class="post-list__meta--tags tags"></span><a class="btn-border-small" href=/2016/05/scenekit-03/>继续阅读</a></div>
   </div>
   
   
   
   
   <div class="read-more-item">
       <span class="read-more-item-dim">更早的文章</span>
       <h2 class="post-list__post-title post-title"><a href="/2016/04/scenekit-01/" title="link to 「从零开始」做一个水果忍者那样的游戏（Scene Kit 基础教程）第 1 节：开始">「从零开始」做一个水果忍者那样的游戏（Scene Kit 基础教程）第 1 节：开始</a></h2>
       <p class="excerpt">原文：Scene Kit Tutorial with Swift Part 1: Getting Started注：这是《3D iOS 游戏教程》这本书中一个章节的缩写版，来让您可以来领略一下这本书的内容。希望您喜欢！这一教程将向你展示如何使用苹果最新的游戏框架－SceneKit，来创建你的第一个 3D 游戏。如果在你的想象中，认为 3D 游戏编程要远比 2D 游戏编程复杂的多，这种偏见是可以被谅解的。因为 3D 游戏编程通常涉及许多复杂的数学计算，所有一直有一个名声 —— 就是 TMD ...&hellip;</p>
       <div class="post-list__meta"><time datetime="2016-04-29 03:42:35 +0800" class="post-list__meta--date date">2016-04-29</time> &#8226; <span class="post-list__meta--tags tags">3d-game</span><a class="btn-border-small" href=/2016/04/scenekit-01/>继续阅读</a></div>
   </div>
   
</section>

<section class="post-comments">
  
    <div id="disqus_thread"></div>
    <script>
    
    var disqus_config = function () {
        this.page.url = "http://vno.onevcat.com/2016/05/scenekit-02/";
        this.page.identifier = "/2016/05/scenekit-02/";
    };

    var disqus_shortname = 'vno-jekyll';
    
    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();
    </script>
    <noscript>要查看<a href="http://disqus.com/?ref_noscript"> Disqus </a>评论，请启用 JavaScript</noscript>
    
  
  
  
  
</section>


            <section class="footer">
    <footer>
    	<span class="footer__copyright">本站点采用<a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享 署名-非商业性使用-相同方式共享 4.0 国际 许可协议</a></span>
        <span class="footer__copyright">由 <a href="https://jekyllrb.com">Jekyll</a> 于 2016-09-20 生成，感谢 <a href="https://www.digitalocean.com/?refcode=5a864881b7fb">Digital Ocean</a> 为本站提供稳定的 VPS 服务</span>
        <span class="footer__copyright">本站由 <a href="http://iosinit.com">@方一雄</a> 创建，采用 <a href="https://github.com/onevcat/vno-jekyll">Vno - Jekyll</a> 作为主题，您可以在 GitHub 找到<a href="https://github.com/FangYiXiong/iosinit">本站源码</a> - &copy; 2016</span>
    </footer>
</section>

        </div>
    </div>
    
    <script type="text/javascript" src="//code.jquery.com/jquery-1.11.3.min.js"></script>

<script type="text/javascript" src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script type="text/javascript" src="/js/main.js"></script>



    
  </body>

</html>
